<!-- VinylBeats - corrig√© et am√©lior√© -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VinylBeats - Lecteur Musical</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);
      color:#fff;
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* header */
    .header{padding:24px;text-align:center;background:rgba(0,0,0,0.18);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,0.04)}
    .header h1{font-size:2.4rem;background:linear-gradient(45deg,#ff6b6b,#4ecdc4,#45b7d1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px}
    .header p{color:rgba(255,255,255,0.75);margin-bottom:14px}

    .search-container{margin:0 auto 18px;max-width:680px;position:relative;padding:0 16px}
    .search-input{width:100%;padding:14px 52px 14px 18px;border-radius:999px;border:1px solid rgba(255,255,255,0.07);background:rgba(255,255,255,0.04);color:#fff;font-size:15px}
    .search-input::placeholder{color:rgba(255,255,255,0.5)}
    .search-btn{position:absolute;right:26px;top:50%;transform:translateY(-50%);background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;color:#fff;font-size:16px}

    /* grid */
    .music-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:30px;padding:36px 20px;max-width:1200px;margin:0 auto}

    .vinyl-card{cursor:pointer;transition:transform .22s ease,box-shadow .22s ease;padding:8px}
    .vinyl-card:hover{transform:translateY(-6px)}

    .vinyl-disc{width:200px;height:200px;border-radius:50%;background:linear-gradient(180deg,#222,#111);position:relative;margin:0 auto 14px;box-shadow:0 10px 30px rgba(0,0,0,0.6);overflow:hidden;display:flex;align-items:center;justify-content:center}
    .vinyl-disc.spinning{animation:spin 3s linear infinite}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

    .vinyl-grooves{position:absolute;inset:0;display:block}
    .groove{position:absolute;border-radius:50%;border:1px solid rgba(255,255,255,0.05);top:50%;left:50%;transform:translate(-50%,-50%)}

    .album-cover{width:120px;height:120px;border-radius:50%;object-fit:cover;z-index:2;box-shadow:inset 0 4px 10px rgba(0,0,0,0.6)}

    .track-info{text-align:center;padding:0 6px}
    .track-title{font-size:1.05rem;font-weight:700;margin-bottom:6px;color:#fff}
    .track-artist{color:#4ecdc4;font-size:0.9rem;margin-bottom:6px}
    .track-album{color:rgba(255,255,255,0.75);font-size:0.82rem}

    /* player */
    .player{position:fixed;left:0;right:0;bottom:0;background:rgba(5,5,10,0.85);backdrop-filter:blur(12px);padding:14px;border-top:1px solid rgba(255,255,255,0.04);display:none}
    .player-content{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:18px}
    .current-track{display:flex;align-items:center;gap:12px;flex:1}
    .current-album-cover{width:60px;height:60px;border-radius:8px;object-fit:cover}
    .current-info h4{margin-bottom:4px;font-size:1rem}
    .current-info p{color:#4ecdc4;font-size:0.9rem;margin:0}

    .player-controls{display:flex;align-items:center;gap:10px}
    .control-btn{background:none;border:none;color:#fff;font-size:20px;cursor:pointer;padding:8px;border-radius:8px}
    .control-btn:hover{background:rgba(255,255,255,0.03)}
    .play-btn{background:linear-gradient(45deg,#ff6b6b,#4ecdc4);padding:8px 12px;border-radius:8px}

    .loading{text-align:center;padding:40px;color:#4ecdc4}

    /* responsive */
    @media (max-width:900px){
      .music-grid{grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:18px;padding:20px}
      .vinyl-disc{width:160px;height:160px}
      .album-cover{width:96px;height:96px}
      .player-content{flex-direction:column;align-items:flex-start}
    }

    /* active card highlight */
    .vinyl-card.active{outline:2px solid rgba(78,205,196,0.12);border-radius:10px}
  </style>
</head>
<body>
  <div class="header">
    <h1>üéµ VinylBeats</h1>
    <p>D√©couvrez la musique avec style ‚Äî recherche powered by Deezer (aper√ßu 30s)</p>
    <div class="search-container">
      <input id="searchInput" class="search-input" type="text" placeholder="Rechercher un artiste, album ou chanson... (entr√©e pour lancer)" aria-label="Recherche">
      <button id="searchBtn" class="search-btn" title="Rechercher">üîç</button>
    </div>
  </div>

  <div id="loading" class="loading">Chargement des hits du moment...</div>
  <div id="musicGrid" class="music-grid" aria-live="polite"></div>

  <div id="player" class="player" role="region" aria-label="lecteur">
    <div class="player-content">
      <div class="current-track">
        <img id="currentCover" class="current-album-cover" src="https://via.placeholder.com/300" alt="pochette actuelle">
        <div class="current-info">
          <h4 id="currentTitle">Titre</h4>
          <p id="currentArtist">Artiste</p>
        </div>
      </div>

      <div class="player-controls">
        <button id="prevBtn" class="control-btn" title="Pr√©c√©dent">‚èÆÔ∏è</button>
        <button id="playBtn" class="control-btn play-btn" title="Lecture/Pause">‚ñ∂Ô∏è</button>
        <button id="nextBtn" class="control-btn" title="Suivant">‚è≠Ô∏è</button>
      </div>
    </div>
  </div>

  <script>
class VinylMusicApp {
    constructor() {
        this.currentTrack = null;
        this.isPlaying = false;
        this.tracks = [];
        this.currentIndex = 0;
        this.audio = new Audio();

        this.initializeElements();
        this.setupEventListeners();
        this.loadPopularTracks();
    }

    initializeElements() {
        this.searchInput = document.getElementById('searchInput');
        this.searchBtn = document.getElementById('searchBtn');
        this.musicGrid = document.getElementById('musicGrid');
        this.loading = document.getElementById('loading');
        this.player = document.getElementById('player');
        this.playBtn = document.getElementById('playBtn');
        this.prevBtn = document.getElementById('prevBtn');
        this.nextBtn = document.getElementById('nextBtn');
        this.currentCover = document.getElementById('currentCover');
        this.currentTitle = document.getElementById('currentTitle');
        this.currentArtist = document.getElementById('currentArtist');
    }

    setupEventListeners() {
        this.searchBtn.addEventListener('click', () => this.searchTracks());
        this.searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.searchTracks();
        });

        this.playBtn.addEventListener('click', () => this.togglePlay());
        this.prevBtn.addEventListener('click', () => this.previousTrack());
        this.nextBtn.addEventListener('click', () => this.nextTrack());

        this.audio.addEventListener('ended', () => this.nextTrack());
    }

    async loadPopularTracks() {
        try {
            const response = await fetch(`https://corsproxy.io/?${encodeURIComponent('https://api.deezer.com/chart/0/tracks?limit=20')}`);
            const data = await response.json();
            this.tracks = data.data;
            this.displayTracks(this.tracks);
            this.loading.style.display = 'none';
        } catch (error) {
            console.error('Erreur lors du chargement:', error);
            this.loading.textContent = 'Erreur de chargement.';
            this.loadDemoTracks();
        }
    }

    async searchTracks() {
        const query = this.searchInput.value.trim();
        if (!query) return;

        this.loading.style.display = 'block';
        this.loading.textContent = 'Recherche en cours...';

        try {
            const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.deezer.com/search?q=${query}&limit=20`)}`);
            const data = await response.json();
            this.tracks = data.data;
            this.displayTracks(this.tracks);
            this.loading.style.display = 'none';
        } catch (error) {
            console.error('Erreur de recherche:', error);
            this.loading.textContent = 'Erreur de recherche';
            setTimeout(() => this.loading.style.display = 'none', 2000);
        }
    }

    loadDemoTracks() {
        this.tracks = [
            {
                id: 1,
                title: "Bohemian Rhapsody",
                artist: { name: "Queen" },
                album: { title: "A Night at the Opera", cover_medium: "/placeholder.svg" },
                preview: ""
            }
        ];
        this.displayTracks(this.tracks);
        this.loading.style.display = 'none';
    }

    displayTracks(tracks) {
        this.musicGrid.innerHTML = '';
        tracks.forEach((track, index) => {
            const card = this.createVinylCard(track, index);
            this.musicGrid.appendChild(card);
        });
    }

    createVinylCard(track, index) {
        const card = document.createElement('div');
        card.className = 'vinyl-card';
        card.addEventListener('click', () => this.playTrack(track, index));

        card.innerHTML = `
            <div class="vinyl-disc" id="vinyl-${track.id}">
                <div class="vinyl-grooves">${this.createGrooves()}</div>
                <img src="${track.album?.cover_medium}" alt="${track.album?.title}" class="album-cover">
            </div>
            <div class="track-info">
                <div class="track-title">${track.title}</div>
                <div class="track-artist">${track.artist?.name}</div>
                <div class="track-album">${track.album?.title}</div>
            </div>
        `;
        return card;
    }

    createGrooves() {
        let grooves = '';
        for (let i = 0; i < 8; i++) {
            const size = 160 - (i * 15);
            grooves += `<div class="groove" style="width:${size}px;height:${size}px;"></div>`;
        }
        return grooves;
    }

    playTrack(track, index) {
        this.currentTrack = track;
        this.currentIndex = index;
        this.currentCover.src = track.album?.cover_medium;
        this.currentTitle.textContent = track.title;
        this.currentArtist.textContent = track.artist?.name;
        this.player.style.display = 'block';
        this.animateVinyl(track.id);

        if (track.preview) {
            this.audio.src = track.preview;
            this.audio.play();
            this.isPlaying = true;
            this.playBtn.textContent = '‚è∏Ô∏è';
        }
    }

    animateVinyl(trackId) {
        document.querySelectorAll('.vinyl-disc').forEach(disc => {
            disc.classList.remove('spinning');
        });
        const currentVinyl = document.getElementById(`vinyl-${trackId}`);
        if (currentVinyl) currentVinyl.classList.add('spinning');
    }

    togglePlay() {
        if (this.isPlaying) {
            this.audio.pause();
            this.isPlaying = false;
            this.playBtn.textContent = '‚ñ∂Ô∏è';
        } else {
            this.audio.play();
            this.isPlaying = true;
            this.playBtn.textContent = '‚è∏Ô∏è';
        }
    }

    previousTrack() {
        if (this.currentIndex > 0) {
            this.playTrack(this.tracks[this.currentIndex - 1], this.currentIndex - 1);
        }
    }

    nextTrack() {
        if (this.currentIndex < this.tracks.length - 1) {
            this.playTrack(this.tracks[this.currentIndex + 1], this.currentIndex + 1);
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new VinylMusicApp();
});
</script>


</body>
</html>
